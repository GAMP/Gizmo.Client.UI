@namespace Gizmo.Client.UI.Pages
@inherits CustomDOMComponentBase
@using Gizmo.Client.UI.ViewModels

<div class="giz-product-details-wrapper">
    <div class="giz-product-details">
        <div class="giz-product-details__product giz-scrollbar--v">
            <div class="giz-product-details__product__navigation" @onclick="OnClickBackButtonHandler">
                <div class="giz-product-details__product__navigation__icon">
                    <Icon SVGIcon="Icons.ArrowLeftLong_Client" />
                </div>
                <div class="giz-product-details__product__navigation__label">
                    @LocalizationService.GetString("GIZ_GEN_BACK")
                </div>
            </div>
            <div class="giz-product-details__product__info">
                <div class="giz-product-details__product__info__image">
                    <GizImage ImageType="Gizmo.UI.ImageType.ProductDefault" ImageId="@ViewState.Product?.DefaultImageId" ImageFitType="ImageFitType.Cover">
                        <EmptyResultPlaceholder>
                            <div class="giz-default-image">
                                <img src="_content/Gizmo.Client.UI/img/no-product-image.svg" alt='loading' />
                            </div>
                        </EmptyResultPlaceholder>
                    </GizImage>
                </div>
                <div class="giz-product-details__product__info__basic">
                    <div class="giz-product-details__product__info__basic__category">
                        @_userProductGroupViewState.Name
                    </div>
                    <div class="giz-product-details__product__info__basic__title">
                        @ViewState.Product?.Name
                    </div>
                    <div class="giz-product-details__product__info__basic__host-groups">
                        @if (ViewState.Product != null && ViewState.Product.ProductType == ProductType.ProductTime && _hostGroups != null)
                        {
                            @foreach (var item in _hostGroups)
                            {
                                @if (!ViewState.Product.TimeProduct.DisallowedHostGroups.Contains(item.Id))
                                {
                                    <div class="giz-time-product-host-group @(item.Id == ViewState.CurrentHostGroupId ? "active" : "")">
                                        <Icon Size="IconSizes.Small" SVGIcon="Icons.Passport_Client" />
                                        <div>@item.Name</div>
                                    </div>
                                }
                            }
                        }
                    </div>
                    <div class="giz-product-details__product__info__basic__description">
                        @ViewState.Product?.Description
                    </div>
                    <div class="giz-product-details__product__info__basic__action">
                        <div class="giz-product-details__product__info__basic__action__price">
                            <ProductCardPrice Product="@ViewState.Product" Icon="1" />
                        </div>
                        <ProductQuantityPicker @key="ProductId" ProductId="@ProductId" Size="ButtonSizes.ExtraLarge" IsFullWidth="false" />
                    </div>
                </div>
                @if (ViewState.Product != null)
                {
                    <div class="giz-product-details__product__info__additional">
                        @if (ViewState.Product.PurchaseAvailability != null || (ViewState.Product.ProductType == ProductType.ProductTime && ViewState.Product.PurchaseAvailability != null))
                        {
                            <div class="giz-product-details__product__info__additional__availability">
                                @if (ViewState.Product.PurchaseAvailability != null)
                                {
                                    <div class="giz-product-availability">
                                        <div class="giz-product-availability__title">
                                            @LocalizationService.GetString("GIZ_PRODUCT_TIME_EXPIRATION_BUYING_TIME")
                                        </div>
                                        <div class="giz-product-availability__body">
                                            @if (ViewState.Product.PurchaseAvailability.DateRange && ViewState.Product.PurchaseAvailability.StartDate.HasValue && ViewState.Product.PurchaseAvailability.EndDate.HasValue)
                                            {
                                                <div class="giz-product-availability-day">@($"{ViewState.Product.PurchaseAvailability.StartDate.Value.ToShortDateString()}-{ViewState.Product.PurchaseAvailability.EndDate.Value.ToShortDateString()}")</div>
                                            }
                                            else
                                            {
                                                @foreach (var day in ViewState.Product.PurchaseAvailability.DaysAvailable)
                                                {
                                                    <div class="giz-product-availability-day">@GetAvailabilityText(day)</div>
                                                }
                                            }
                                        </div>
                                    </div>
                                }
                                @if (ViewState.Product.ProductType == ProductType.ProductTime && ViewState.Product.TimeProduct.UsageAvailability != null)
                                {
                                    <div class="giz-product-availability">
                                        <div class="giz-product-availability__title">
                                            @LocalizationService.GetString("GIZ_PRODUCT_TIME_EXPIRATION_ACTION_TIME")
                                        </div>
                                        <div class="giz-product-availability__body">
                                            @if (ViewState.Product.TimeProduct.UsageAvailability.DateRange && ViewState.Product.TimeProduct.UsageAvailability.StartDate.HasValue && ViewState.Product.TimeProduct.UsageAvailability.EndDate.HasValue)
                                            {
                                                <div class="giz-product-availability-day">@($"{ViewState.Product.TimeProduct.UsageAvailability.StartDate.Value.ToShortDateString()}-{ViewState.Product.TimeProduct.UsageAvailability.EndDate.Value.ToShortDateString()}")</div>
                                            }
                                            else
                                            {
                                                @foreach (var day in ViewState.Product.TimeProduct.UsageAvailability.DaysAvailable)
                                                {
                                                    <div class="giz-product-availability-day">@GetAvailabilityText(day)</div>
                                                }
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        @if (ViewState.Product.ProductType == ProductType.ProductTime && ViewState.Product.TimeProduct.ExpirationOptions != ProductTimeExpirationOptionType.None)
                        {
                            <div class="giz-product-details__product__info__additional__expirations">
                                <div class="giz-product-details__product__info__additional__expirations__header">@LocalizationService.GetString("GIZ_PRODUCT_TIME_EXPIRES_AFTER")</div>
                                <div class="giz-product-details__product__info__additional__expirations__body">

                                    @if (ViewState.Product.TimeProduct.ExpirationOptions.HasFlag(ProductTimeExpirationOptionType.ExpireAtDayTime))
                                    {
                                        <div class="giz-product-expiration">@GetDayTimeFromMinute()<Icon SVGIcon="Icons.Info_Client" Size="IconSizes.Small" /></div>
                                    }
                                
                                    @if (ViewState.Product.TimeProduct.ExpirationOptions.HasFlag(ProductTimeExpirationOptionType.ExpireAfterTime))
                                    {
                                        <div class="giz-product-expiration">@GetAfterText()<Icon SVGIcon="Icons.Info_Client" Size="IconSizes.Small" /></div>
                                    }

                                    @if (ViewState.Product.TimeProduct.ExpirationOptions.HasFlag(ProductTimeExpirationOptionType.ExpiresAtLogout))
                                    {
                                        <div class="giz-product-expiration">@LocalizationService.GetString("GIZ_PRODUCT_TIME_EXPIRATION_LOGOUT")<Icon SVGIcon="Icons.Info_Client" Size="IconSizes.Small" /></div>
                                    }

                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
            @if (@ViewState.Product?.ProductType == ProductType.ProductBundle)
            {
                <div class="giz-product-details__product__bundled-products">
                    @foreach (var product in ViewState.Product.BundledProducts)
                    {
                        <div class="giz-product-details__product__bundled-products-product">
                            <GizImage ImageType="Gizmo.UI.ImageType.ProductDefault" ImageId="@ViewState.Product.DefaultImageId">
                                <EmptyResultPlaceholder>
                                    <div class="giz-default-image">
                                        <img src="_content/Gizmo.Client.UI/img/no-product-image.svg" alt='loading' />
                                    </div>
                                </EmptyResultPlaceholder>
                            </GizImage>
                        </div>
                    }
                </div>
            }
            <div class="giz-product-details__product__related">
                <div class="giz-product-details__product__related__header">
                    @LocalizationService.GetString("GIZ_SHOP_RELATED_PRODUCTS")
                </div>

                <div class="giz-product-details__product__related__body">
                    @if (ViewState.RelatedProducts != null)
                    {
                        @foreach (var product in ViewState.RelatedProducts)
                        {
                            <ProductCard @key="product.Id" Product="@product" />
                        }
                    }
                </div>
            </div>
        </div>
        <div class="giz-product-details__order">
            <GizOrder />
        </div>
    </div>
</div>

@namespace Gizmo.Client.UI.Pages
@inherits ComponentBase
@using System.Threading;
@using Gizmo.Web.Components
@using Gizmo.Client.UI.Components
@using Microsoft.AspNetCore.Components.Forms
@using Gizmo.UI.Services

@inject ILocalizationService localizationService

<div class="giz-settings giz-scrollbar--v">
    <div class="giz-settings__content">
        <div class="giz-settings__content__header">
            <div class="giz-settings__content__header__icon" @onclick="OnClickChangePictureButtonHandler">
                <Icon Size="IconSizes.ExtraLarge" SVGIcon="Icons.AccountCircle_Client" />
            </div>
            <div class="giz-settings__content__header__title">@localizationService.GetString("GIZ_USER_SETTINGS_TITLE")</div>
            <div class="giz-settings__content__header__subtitle">@localizationService.GetString("GIZ_USER_ADDITIONAL_INFORMATION")</div>
        </div>
        <div class="giz-settings__content__body">
            
            <div class="giz-section">
                <div class="giz-section__header">@localizationService.GetString("GIZ_GEN_USERNAME")</div>
                <div class="giz-section__body">
                    <div class="giz-form-input">
                        <TextInput Value="@UserSettingsService.ViewState.Username"
                                   ValueChanged="@((string value) => UserSettingsService.SetUsername(value))"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_USER_USERNAME_MESSAGE")" />
                    </div>
                </div>
            </div>
            
            <ExpansionPanel>
                <Header>@localizationService.GetString("GIZ_USER_PERSONAL_INFORMATION")</Header>
                <ChildContent>
                    <div class="giz-form-input giz-form-input-columns">
                        <TextInput Value="@UserSettingsService.ViewState.FirstName"
                                   ValueChanged="@((string value) => UserSettingsService.SetFirstName(value))"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_USER_FIRST_NAME")" />
                        <TextInput Value="@UserSettingsService.ViewState.LastName"
                                   ValueChanged="@((string value) => UserSettingsService.SetLastName(value))"
                                   Size="InputSizes.Medium" IsFullWidth="true" Label="@localizationService.GetString("GIZ_USER_LAST_NAME")" />
                    </div>
            
                    <div class="giz-form-input giz-form-input-columns">
                        <MaskedDateInput Value="@UserSettingsService.ViewState.BirthDate"
                                         ValueChanged="@((DateTime? value) => UserSettingsService.SetBirthDate(value))"
                                         Size="InputSizes.Medium"
                                         IsFullWidth="true"
                                         Label="@localizationService.GetString("GIZ_USER_BIRTH_DATE")" />
                        <Select HandleSVGIcon="Icons.Select_Client"
                                Value="@UserSettingsService.ViewState.Sex"
                                ValueChanged="@((Sex value) => UserSettingsService.SetSex(value))"
                                Size="InputSizes.Medium"
                                IsFullWidth="true"
                                Label="@localizationService.GetString("GIZ_USER_GENDER")"
                                OpenDirection="PopupOpenDirections.Cursor"
                                PopupClass="giz-scrollbar--v">
                            <SelectItem Value="@Sex.Unspecified" Text="Unspecified" />
                            <SelectItem Value="@Sex.Male" Text="Male" />
                            <SelectItem Value="@Sex.Female" Text="Female" />
                        </Select>
                    </div>
            
                    <div class="giz-form-input">
                        <TextInput Value="@UserSettingsService.ViewState.Country"
                                   ValueChanged="@((string value) => UserSettingsService.SetCountry(value))"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_USER_COUNTRY_REGION")" />
                    </div>
            
                    <div class="giz-form-input">
                        <TextInput Value="@UserSettingsService.ViewState.Address"
                                   ValueChanged="@((string value) => UserSettingsService.SetAddress(value))"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_USER_ADDRESS")" />
                    </div>
                </ChildContent>
            </ExpansionPanel>

            <ExpansionPanel>
                <Header>@localizationService.GetString("GIZ_USER_MAIL_AND_PHONE_NUMBERS")</Header>
                <ChildContent>
                    <div class="giz-form-input">
                        <TextInput Value="@UserSettingsService.ViewState.Email"
                                   ValueChanged="@((string value) => UserSettingsService.SetEmail(value))"
                                   IsReadOnly="@(UserPasswordRecoveryMethodService.ViewState.Method == View.UserPasswordRecoveryMethod.Email)"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_GEN_EMAIL_ADDRESS")">
                            <RightContent>
                                @if (UserPasswordRecoveryMethodService.ViewState.Method == View.UserPasswordRecoveryMethod.Email)
                                {
                                    <div class="giz-settings-update-button" @onclick="OnClickUpdateEmailButtonHandler">@localizationService.GetString("GIZ_GEN_UPDATE")</div>
                                }
                            </RightContent>
                        </TextInput>
                    </div>
            
                    <div class="giz-form-input">
                        <TextInput Value="@UserSettingsService.ViewState.MobilePhone" 
                                   ValueChanged="@((string value) => UserSettingsService.SetMobilePhone(value))"
                                   IsReadOnly="@(UserPasswordRecoveryMethodService.ViewState.Method == View.UserPasswordRecoveryMethod.MobilePhone)"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_GEN_MOBILE_PHONE")">
                            <RightContent>
                                @if (UserPasswordRecoveryMethodService.ViewState.Method == View.UserPasswordRecoveryMethod.MobilePhone)
                                {
                                    <div class="giz-settings-update-button" @onclick="OnClickUpdateMobileButtonHandler">@localizationService.GetString("GIZ_GEN_UPDATE")</div>
                                }
                            </RightContent>
                        </TextInput>
                    </div>
            
                    <div class="giz-form-input">
                        <TextInput Value="@UserSettingsService.ViewState.Phone" 
                                   ValueChanged="@((string value) => UserSettingsService.SetPhone(value))"
                                   Size="InputSizes.Medium"
                                   IsFullWidth="true"
                                   Label="@localizationService.GetString("GIZ_USER_HOME_PHONE")" />
                    </div>
                </ChildContent>
            </ExpansionPanel>
                        
            <ExpansionPanel>
                <Header>@localizationService.GetString("GIZ_GEN_PASSWORD")</Header>
                <ChildContent>
                    <div class="giz-settings-change-password" @onclick="OnClickChangePasswordButtonHandler">
                        @localizationService.GetString("GIZ_USER_CHANGE_PASSWORD")
                    </div>
                </ChildContent>
            </ExpansionPanel>

            <div>
                <Button Color="ButtonColors.Accent" Size="ButtonSizes.ExtraLarge" IsFullWidth="true" @onclick="@(() => UserSettingsService.SubmitAsync())">@localizationService.GetString("GIZ_GEN_SAVE_CHANGES")</Button>
            </div>

        </div>
    </div>
    @*<div class="giz-settings__notifications">
        <Toast CanClose="true" OnCloseButtonClick="OnCloseButtonClickHandler" AlertType="AlertTypes.Success" Text="Test" />
    </div>*@
</div>
